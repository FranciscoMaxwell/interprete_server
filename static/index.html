<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interpretador IA</title>
</head>
<body>
<h1>Chat com Tradução e Voz</h1>

<label>Nome: <input id="nome" value="Usuário"></label>
<label>Idioma: 
<select id="idioma">
  <option value="pt">Português</option>
  <option value="en">Inglês</option>
</select>
</label>

<button onclick="connect()">Conectar</button>
<div id="chat"></div>
<input id="msg" placeholder="Digite sua mensagem">
<button onclick="sendMsg()">Enviar</button>

<script>
let ws;
let nome, idioma;

function connect() {
    nome = document.getElementById("nome").value;
    idioma = document.getElementById("idioma").value;

    ws = new WebSocket("wss://interpreteserver-production.up.railway.app/ws");

    ws.onopen = () => {
        console.log("Conectado!");
        ws.send(JSON.stringify({nome, idioma}));
    };

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        const chat = document.getElementById("chat");
        const p = document.createElement("p");
        p.textContent = `${data.de}: ${data.texto}`;
        chat.appendChild(p);

        // Reproduz áudio
        if(data.audio){
            const audio = new Audio(data.audio);
            audio.play();
        }
    };

    ws.onerror = (err) => {
        console.error("WebSocket error:", err);
    };
}

function sendMsg() {
    const texto = document.getElementById("msg").value;
    ws.send(JSON.stringify({texto, idioma}));
}
</script>
</body>
</html>
